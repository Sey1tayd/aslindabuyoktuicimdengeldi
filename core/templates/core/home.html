{% extends 'core/base.html' %}
{% load static %}

{% block title %}Sarac Ä°hsan â€“ At EkipmanlarÄ± ve KoÅŸum TakÄ±mlarÄ±{% endblock %}

{% block extra_head %}
  <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"></script>
{% endblock %}

{% block content %}
<main id="content" role="main">

    <!-- ============ HERO CAROUSEL WITH 3D MODELS ============ -->
    <div class="carousel">
      <div class="list">
        <!-- Item 1 -->
        <div class="item">
          <div class="introduce">
            <div class="title">Ã–ZEL KOLEKSÄ°YON</div>
            <div class="topic">Kalite<br>ve GÃ¼ven</div>
            <div class="des">At ekipmanlarÄ± ve koÅŸum takÄ±mlarÄ± konusunda yÄ±llarÄ±n deneyimi ile kaliteli Ã¼rÃ¼nler sunuyoruz.</div>
            <button class="seeMore">KEÅžFET &#8599</button>
          </div>
          <model-viewer 
            src="/media/showcase/model.glb" 
            alt="3D Model" 
            camera-controls 
            shadow-intensity="1"
            exposure="1"
            environment-image="neutral"
            ar-modes="none">
          </model-viewer>
          <div class="badge">KALÄ°TE<br>GÃœVENCE</div>
        </div>

        <!-- Item 2 -->
        <div class="item">
          <div class="introduce">
            <div class="title">PREMIUM EKÄ°PMANLAR</div>
            <div class="topic">MÃ¼kemmel<br>Ä°ÅŸÃ§ilik</div>
            <div class="des">Ã–zenle seÃ§ilmiÅŸ premium ekipmanlar ile atÄ±nÄ±zÄ±n ihtiyaÃ§larÄ±nÄ± karÅŸÄ±layÄ±n.</div>
            <button class="seeMore">KEÅžFET &#8599</button>
          </div>
          <model-viewer 
            src="/media/showcase/model (1).glb" 
            alt="3D Model" 
            camera-controls 
            shadow-intensity="1"
            exposure="1"
            environment-image="neutral"
            ar-modes="none">
          </model-viewer>
          <div class="badge">PREMIUM<br>KALÄ°TE</div>
        </div>

        <!-- Item 3 -->
        <div class="item">
          <div class="introduce">
            <div class="title">GENÄ°Åž ÃœRÃœN YELPAZESÄ°</div>
            <div class="topic">Her Ä°htiyaca<br>Ã‡Ã¶zÃ¼m</div>
            <div class="des">TÄ±mar ekipmanlarÄ±ndan koÅŸum takÄ±mlarÄ±na, binici ekipmanlarÄ±ndan nalbant malzemelerine kadar geniÅŸ Ã¼rÃ¼n yelpazesi.</div>
            <button class="seeMore">KEÅžFET &#8599</button>
          </div>
          <model-viewer 
            src="/media/showcase/model (2).glb" 
            alt="3D Model" 
            camera-controls 
            shadow-intensity="1"
            exposure="1"
            environment-image="neutral"
            ar-modes="none">
          </model-viewer>
          <div class="badge">GENÄ°Åž<br>YELPAZE</div>
        </div>

        <!-- Item 4 -->
        <div class="item">
          <div class="introduce">
            <div class="title">GELENEKSEL KALÄ°TE</div>
            <div class="topic">YÄ±llarÄ±n<br>Bilgisi</div>
            <div class="des">Geleneksel iÅŸÃ§ilik ile modern teknolojinin buluÅŸtuÄŸu noktada kaliteli Ã¼rÃ¼nler.</div>
            <button class="seeMore">KEÅžFET &#8599</button>
          </div>
          <model-viewer 
            src="/media/showcase/model (3).glb" 
            alt="3D Model" 
            camera-controls 
            shadow-intensity="1"
            exposure="1"
            environment-image="neutral"
            ar-modes="none">
          </model-viewer>
          <div class="badge">GELENEKSEL<br>KALÄ°TE</div>
        </div>

        <!-- Item 5 -->
        <div class="item">
          <div class="introduce">
            <div class="title">GÃœVENÄ°LÄ°R MARKA</div>
            <div class="topic">Sarac<br>Ä°hsan</div>
            <div class="des">At ekipmanlarÄ± konusunda gÃ¼venilir adresiniz. Her Ã¼rÃ¼n titizlikle seÃ§ilir ve kalite garantisi sunar.</div>
            <button class="seeMore">KEÅžFET &#8599</button>
          </div>
          <model-viewer 
            src="/media/showcase/model (4).glb" 
            alt="3D Model" 
            camera-controls 
            shadow-intensity="1"
            exposure="1"
            environment-image="neutral"
            ar-modes="none">
          </model-viewer>
          <div class="badge">GÃœVENÄ°LÄ°R<br>MARKA</div>
        </div>

        <!-- Item 6 -->
        <div class="item">
          <div class="introduce">
            <div class="title">PROFESYONEL HÄ°ZMET</div>
            <div class="topic">Uzman<br>DanÄ±ÅŸmanlÄ±k</div>
            <div class="des">At ekipmanlarÄ± konusunda uzman ekibimizle ihtiyacÄ±nÄ±za en uygun Ã¼rÃ¼nÃ¼ bulabilirsiniz.</div>
            <button class="seeMore">KEÅžFET &#8599</button>
          </div>
          <model-viewer 
            src="/media/showcase/model (6).glb" 
            alt="3D Model" 
            camera-controls 
            shadow-intensity="1"
            exposure="1"
            environment-image="neutral"
            ar-modes="none">
          </model-viewer>
          <div class="badge">PROFESYONEL<br>HÄ°ZMET</div>
        </div>

        <!-- Item 7 -->
        <div class="item">
          <div class="introduce">
            <div class="title">HIZLI TESLÄ°MAT</div>
            <div class="topic">KapÄ±nÄ±za<br>Kadar</div>
            <div class="des">SipariÅŸleriniz hÄ±zlÄ± ve gÃ¼venli bir ÅŸekilde kapÄ±nÄ±za kadar ulaÅŸÄ±r.</div>
            <button class="seeMore">KEÅžFET &#8599</button>
          </div>
          <model-viewer 
            src="/media/showcase/model (7).glb" 
            alt="3D Model" 
            camera-controls 
            shadow-intensity="1"
            exposure="1"
            environment-image="neutral"
            ar-modes="none">
          </model-viewer>
          <div class="badge">HIZLI<br>TESLÄ°MAT</div>
        </div>

        <!-- Item 8 -->
        <div class="item">
          <div class="introduce">
            <div class="title">SÄ°ZE Ã–ZEL</div>
            <div class="topic">Ã–zel<br>Ãœretim</div>
            <div class="des">Standart Ã¼rÃ¼nlerimizin yanÄ±nda Ã¶zel Ã¼retim ve sipariÅŸ imkanlarÄ± da sunuyoruz.</div>
            <button class="seeMore">KEÅžFET &#8599</button>
          </div>
          <model-viewer 
            src="/media/showcase/model (8).glb" 
            alt="3D Model" 
            camera-controls 
            shadow-intensity="1"
            exposure="1"
            environment-image="neutral"
            ar-modes="none">
          </model-viewer>
          <div class="badge">Ã–ZEL<br>ÃœRETÄ°M</div>
        </div>
      </div>
      <div class="arrows">
        <button id="prev">â€¹</button>
        <button id="next">â€º</button>
      </div>
    </div>

    <!-- ============ FEATURED PRODUCTS CAROUSEL ============ -->
    <section class="section section--featured-products">
      <div class="container">
        <div class="section__head">
          <h2>Ã–ne Ã‡Ä±kan ÃœrÃ¼nler</h2>
        </div>
        <div class="featured-products-carousel" id="featuredCarousel">
          <div class="featured-products-track">
            {% if featured_products_static %}
              {% for product in featured_products_static %}
                <div class="featured-product-item">
                  <a href="{% url 'core:product_detail' product_name=product.name|urlencode %}" class="featured-product-link">
                    <div class="featured-product-image" style="background-image: url('{% static product.path %}');"></div>
                    <div class="featured-product-name">
                      {% if "." in product.name %}
                        {% with name=product.name|slice:":-4" %}
                          {{ name|title }}
                        {% endwith %}
                      {% else %}
                        {{ product.name|title }}
                      {% endif %}
                    </div>
                  </a>
                </div>
              {% endfor %}
              <!-- Duplicate items for seamless loop -->
              {% for product in featured_products_static %}
                <div class="featured-product-item">
                  <a href="{% url 'core:product_detail' product_name=product.name|urlencode %}" class="featured-product-link">
                    <div class="featured-product-image" style="background-image: url('{% static product.path %}');"></div>
                    <div class="featured-product-name">
                      {% if "." in product.name %}
                        {% with name=product.name|slice:":-4" %}
                          {{ name|title }}
                        {% endwith %}
                      {% else %}
                        {{ product.name|title }}
                      {% endif %}
                    </div>
                  </a>
                </div>
              {% endfor %}
            {% else %}
              <!-- Placeholder items when no products -->
              {% for i in "12345678901234567890" %}
                <div class="featured-product-item">
                  <div class="featured-product-link featured-product-placeholder">
                    <div class="featured-product-image featured-product-image-placeholder">
                      <span class="placeholder-icon">ðŸ“¦</span>
                    </div>
                    <div class="featured-product-name featured-product-name-placeholder">
                      ÃœrÃ¼n Eklenecek
                    </div>
                  </div>
                </div>
              {% endfor %}
            {% endif %}
          </div>
        </div>
      </div>
    </section>

    <!-- ============ SHOP BY CATEGORY ============ -->
    <section class="section section--categories">
      <div class="container">
        <div class="section__head">
          <h2>Kategoriler</h2>
          <p>Ä°htiyacÄ±nÄ±za uygun kategoriyi seÃ§in ve geniÅŸ Ã¼rÃ¼n yelpazemizi keÅŸfedin</p>
        </div>

        <div class="categories-grid" role="list">
          {% if categories_with_mapping %}
            {% for cat_data in categories_with_mapping %}
              {% with category=cat_data.category mapping=cat_data.mapping %}
                {% if forloop.counter == 1 %}
                  <!-- Ä°lk satÄ±r: Sol bÃ¼yÃ¼k kategori -->
                  <a class="cat cat--large cat--row1-left {{ mapping.css_class }}" role="listitem" href="{% url 'core:category_detail' category.slug %}" style="background-image: url('{% static 'images/categories/'|add:mapping.image %}');">
                    <span class="cat__overlay"></span>
                    <span class="cat__name">{{ category.name }}</span>
                  </a>
                {% elif forloop.counter == 2 or forloop.counter == 3 %}
                  <!-- Ä°lk satÄ±r: SaÄŸ kÃ¼Ã§Ã¼k kategoriler -->
                  <a class="cat cat--small {{ mapping.css_class }}" role="listitem" href="{% url 'core:category_detail' category.slug %}" style="background-image: url('{% static 'images/categories/'|add:mapping.image %}');">
                    <span class="cat__overlay"></span>
                    <span class="cat__name">{{ category.name }}</span>
                  </a>
                {% elif forloop.counter == 4 or forloop.counter == 5 %}
                  <!-- Ä°kinci satÄ±r: Sol kÃ¼Ã§Ã¼k kategoriler -->
                  <a class="cat cat--small {{ mapping.css_class }}" role="listitem" href="{% url 'core:category_detail' category.slug %}" style="background-image: url('{% static 'images/categories/'|add:mapping.image %}');">
                    <span class="cat__overlay"></span>
                    <span class="cat__name">{{ category.name }}</span>
                  </a>
                {% elif forloop.counter == 6 %}
                  <!-- Ä°kinci satÄ±r: SaÄŸ bÃ¼yÃ¼k kategori -->
                  <a class="cat cat--large cat--row2-right {{ mapping.css_class }}" role="listitem" href="{% url 'core:category_detail' category.slug %}" style="background-image: url('{% static 'images/categories/'|add:mapping.image %}');">
                    <span class="cat__overlay"></span>
                    <span class="cat__name">{{ category.name }}</span>
                  </a>
                {% else %}
                  <!-- Ekstra kategoriler varsa kÃ¼Ã§Ã¼k olarak ekle -->
                  <a class="cat cat--small {{ mapping.css_class }}" role="listitem" href="{% url 'core:category_detail' category.slug %}" style="background-image: url('{% static 'images/categories/'|add:mapping.image %}');">
                    <span class="cat__overlay"></span>
                    <span class="cat__name">{{ category.name }}</span>
                  </a>
                {% endif %}
              {% endwith %}
            {% endfor %}
          {% else %}
            <!-- Fallback kategoriler -->
            <a class="cat cat--large cat--row1-left cat--racing" role="listitem" href="{% url 'core:category_list' %}" style="background-image: url('{% static 'images/categories/kosum-takimi.jpg' %}');">
              <span class="cat__overlay"></span>
              <span class="cat__name">At KoÅŸu EkipmanlarÄ±</span>
            </a>
            <a class="cat cat--small cat--grooming" role="listitem" href="{% url 'core:category_list' %}" style="background-image: url('{% static 'images/categories/timar.jpg' %}');">
              <span class="cat__overlay"></span>
              <span class="cat__name">TÄ±mar EkipmanlarÄ±</span>
            </a>
            <a class="cat cat--small cat--care" role="listitem" href="{% url 'core:category_list' %}" style="background-image: url('{% static 'images/categories/bakim.jpg' %}');">
              <span class="cat__overlay"></span>
              <span class="cat__name">At BakÄ±m EkipmanlarÄ±</span>
            </a>
            <a class="cat cat--small cat--farrier" role="listitem" href="{% url 'core:category_list' %}" style="background-image: url('{% static 'images/categories/nalbant.jpg' %}');">
              <span class="cat__overlay"></span>
              <span class="cat__name">Nalbant EkipmanlarÄ±</span>
            </a>
            <a class="cat cat--small cat--rider" role="listitem" href="{% url 'core:category_list' %}" style="background-image: url('{% static 'images/categories/binici.jpg' %}');">
              <span class="cat__overlay"></span>
              <span class="cat__name">Binici EkipmanlarÄ±</span>
            </a>
            <a class="cat cat--large cat--row2-right cat--carriage" role="listitem" href="{% url 'core:category_list' %}" style="background-image: url('{% static 'images/categories/eyer.jpg' %}');">
              <span class="cat__overlay"></span>
              <span class="cat__name">Araba ve Fayton TakÄ±mÄ±</span>
            </a>
          {% endif %}
        </div>
      </div>
    </section>

    <!-- ============ CATEGORY PRODUCTS ============ -->
    {% if categories_with_mapping %}
      {% for cat_data in categories_with_mapping %}
        {% with category=cat_data.category mapping=cat_data.mapping %}
          {% if category_with_products %}
            {% for category_name, products in category_with_products.items %}
              {% if category_name == category.name %}
                {% if products %}
                  <section class="section section--category-products">
                    <div class="container">
                      <div class="category-products__header">
                        <h3 class="category-products__title">{{ category.name }}</h3>
                        <a href="{% url 'core:category_detail' category.slug %}" class="category-products__link">TÃ¼mÃ¼nÃ¼ GÃ¶r â†’</a>
                      </div>
                      <div class="grid grid--category-products" role="list">
                        {% for product in products|slice:":8" %}
                          <article class="category-product" role="listitem">
                            <a class="category-product__media" href="{% url 'core:product_detail' product_name=product.name|urlencode %}">
                              <div class="category-product__img" style="background-image: url('{% static product.path %}'); background-size: cover; background-position: center;"></div>
                            </a>
                            <div class="category-product__meta">
                              <h4 class="category-product__title">
                                <a href="{% url 'core:product_detail' product_name=product.name|urlencode %}">
                                  {% if "." in product.name %}
                                    {% with name=product.name|slice:":-4" %}
                                      {{ name|title }}
                                    {% endwith %}
                                  {% else %}
                                    {{ product.name|title }}
                                  {% endif %}
                                </a>
                              </h4>
                            </div>
                          </article>
                        {% endfor %}
                      </div>
                    </div>
                  </section>
                {% endif %}
              {% endif %}
            {% endfor %}
          {% endif %}
        {% endwith %}
      {% endfor %}
    {% endif %}

  </main>
{% endblock %}

{% block extra_scripts %}
  <!-- Carousel Script -->
  <script>
    let nextButton = document.getElementById('next');
    let prevButton = document.getElementById('prev');
    let carousel = document.querySelector('.carousel');
    let listHTML = document.querySelector('.carousel .list');
    
    // Aktif model-viewer'a camera-controls ve auto-rotate ekle, diÄŸerlerinden kaldÄ±r
    function updateCameraControls() {
      let items = document.querySelectorAll('.carousel .list .item');
      items.forEach((item, index) => {
        let modelViewer = item.querySelector('model-viewer');
        if (modelViewer) {
          // Sadece 2. child (aktif podyumdaki) iÃ§in camera-controls ve auto-rotate olsun
          if (index === 1) {
            modelViewer.setAttribute('camera-controls', '');
            modelViewer.setAttribute('auto-rotate', '');
          } else {
            modelViewer.removeAttribute('camera-controls');
            modelViewer.removeAttribute('auto-rotate');
          }
        }
      });
    }
    
    nextButton.onclick = function(){
        showSlider('next');
    }
    prevButton.onclick = function(){
        showSlider('prev');
    }
    let unAcceppClick;
    let autoSlideInterval;
    
    const showSlider = (type) => {
        nextButton.style.pointerEvents = 'none';
        prevButton.style.pointerEvents = 'none';

        carousel.classList.remove('next', 'prev');
        let items = document.querySelectorAll('.carousel .list .item');
        if(type === 'next'){
            listHTML.appendChild(items[0]);
            carousel.classList.add('next');
        }else{
            listHTML.prepend(items[items.length - 1]);
            carousel.classList.add('prev');
        }
        clearTimeout(unAcceppClick);
        unAcceppClick = setTimeout(()=>{
            nextButton.style.pointerEvents = 'auto';
            prevButton.style.pointerEvents = 'auto';
            // Animasyon bittiÄŸinde camera-controls'u gÃ¼ncelle
            updateCameraControls();
            // Model-viewer event'lerini gÃ¼ncelle
            attachModelViewerEvents();
            // Otomatik geÃ§iÅŸi yeniden baÅŸlat
            startAutoSlide();
        }, 2000)
    }
    
    // Otomatik geÃ§iÅŸ fonksiyonu
    function startAutoSlide() {
        // Ã–nceki interval'i temizle
        clearInterval(autoSlideInterval);
        // 5 saniyede bir otomatik geÃ§iÅŸ yap (animasyon sÃ¼resi + bekleme)
        autoSlideInterval = setInterval(() => {
            showSlider('next');
        }, 5000);
    }
    
    // Otomatik geÃ§iÅŸi durdur
    function stopAutoSlide() {
        clearInterval(autoSlideInterval);
    }
    
    let isInteracting = false;
    let interactionTimeout;
    
    // Aktif model-viewer'a mouse event'leri ekle
    let currentModelViewer = null;
    function attachModelViewerEvents() {
        let items = document.querySelectorAll('.carousel .list .item');
        items.forEach((item, index) => {
            let modelViewer = item.querySelector('model-viewer');
            if (modelViewer && index === 1 && modelViewer !== currentModelViewer) {
                // Ã–nceki model-viewer'Ä±n event'lerini temizle
                if (currentModelViewer) {
                    currentModelViewer.removeEventListener('mouseenter', handleMouseEnter);
                    currentModelViewer.removeEventListener('pointerdown', handlePointerDown);
                    currentModelViewer.removeEventListener('pointermove', handlePointerMove);
                    currentModelViewer.removeEventListener('pointerup', handlePointerUp);
                    currentModelViewer.removeEventListener('mouseleave', handleMouseLeave);
                }
                
                currentModelViewer = modelViewer;
                
                // Model Ã¼zerine mouse geldiÄŸinde otomatik geÃ§iÅŸi durdur
                modelViewer.addEventListener('mouseenter', handleMouseEnter);
                
                // Mouse down - kullanÄ±cÄ± modeli hareket ettirmeye baÅŸladÄ±
                modelViewer.addEventListener('pointerdown', handlePointerDown);
                
                // Mouse move - kullanÄ±cÄ± modeli hareket ettiriyor
                modelViewer.addEventListener('pointermove', handlePointerMove);
                
                // Mouse up - kullanÄ±cÄ± modeli hareket ettirmeyi bÄ±raktÄ±
                modelViewer.addEventListener('pointerup', handlePointerUp);
                
                // Mouse ayrÄ±ldÄ±ÄŸÄ±nda tekrar baÅŸlat (eÄŸer etkileÅŸim yoksa)
                modelViewer.addEventListener('mouseleave', handleMouseLeave);
            }
        });
    }
    
    // Event handler fonksiyonlarÄ±
    function handleMouseEnter() {
        stopAutoSlide();
    }
    
    function handlePointerDown() {
        isInteracting = true;
        stopAutoSlide();
        clearTimeout(interactionTimeout);
    }
    
    function handlePointerMove() {
        if (isInteracting) {
            stopAutoSlide();
            clearTimeout(interactionTimeout);
        }
    }
    
    function handlePointerUp() {
        isInteracting = false;
        clearTimeout(interactionTimeout);
        // 2 saniye sonra tekrar baÅŸlat
        interactionTimeout = setTimeout(function() {
            if (!isInteracting) {
                startAutoSlide();
            }
        }, 2000);
    }
    
    function handleMouseLeave() {
        if (!isInteracting) {
            clearTimeout(interactionTimeout);
            interactionTimeout = setTimeout(function() {
                startAutoSlide();
            }, 1000);
        }
    }
    
    // Sayfa yÃ¼klendiÄŸinde ilk kurulum
    window.addEventListener('DOMContentLoaded', function() {
      updateCameraControls();
      attachModelViewerEvents();
      // Ä°lk otomatik geÃ§iÅŸi baÅŸlat
      startAutoSlide();
    });
    
    // Model-viewer'lar yÃ¼klendikten sonra da kontrol et
    document.addEventListener('DOMContentLoaded', function() {
      setTimeout(function() {
        updateCameraControls();
        attachModelViewerEvents();
      }, 500);
    });
    
    // KullanÄ±cÄ± manuel tÄ±kladÄ±ÄŸÄ±nda otomatik geÃ§iÅŸi yeniden baÅŸlat
    nextButton.addEventListener('click', function() {
        startAutoSlide();
    });
    
    prevButton.addEventListener('click', function() {
        startAutoSlide();
    });
  </script>

  <!-- Featured Products Blur Script -->
  <script>
    function updateFeaturedProductsBlur() {
      const carousel = document.getElementById('featuredCarousel');
      if (!carousel) return;
      
      const items = carousel.querySelectorAll('.featured-product-item');
      const carouselRect = carousel.getBoundingClientRect();
      const carouselLeft = carouselRect.left;
      const carouselRight = carouselRect.right;
      const blurZone = 150; // Blur baÅŸlangÄ±Ã§ mesafesi
      
      items.forEach(item => {
        const itemRect = item.getBoundingClientRect();
        const itemLeft = itemRect.left;
        const itemRight = itemRect.right;
        const itemCenter = itemLeft + (itemRect.width / 2);
        
        // Sol kenara yakÄ±nlÄ±k
        const distanceFromLeft = itemCenter - carouselLeft;
        // SaÄŸ kenara yakÄ±nlÄ±k
        const distanceFromRight = carouselRight - itemCenter;
        
        let blurAmount = 0;
        let opacity = 1;
        
        if (distanceFromLeft < blurZone) {
          blurAmount = (blurZone - distanceFromLeft) / blurZone * 8;
          opacity = 0.3 + (distanceFromLeft / blurZone) * 0.7;
        } else if (distanceFromRight < blurZone) {
          blurAmount = (blurZone - distanceFromRight) / blurZone * 8;
          opacity = 0.3 + (distanceFromRight / blurZone) * 0.7;
        }
        
        const image = item.querySelector('.featured-product-image');
        if (image) {
          image.style.filter = `blur(${blurAmount}px)`;
          image.style.opacity = opacity;
        }
      });
    }
    
    // Scroll ve animasyon sÄ±rasÄ±nda blur gÃ¼ncelle
    let blurUpdateInterval;
    
    function startBlurUpdates() {
      updateFeaturedProductsBlur();
      blurUpdateInterval = setInterval(updateFeaturedProductsBlur, 100);
    }
    
    function stopBlurUpdates() {
      if (blurUpdateInterval) {
        clearInterval(blurUpdateInterval);
      }
    }
    
    window.addEventListener('DOMContentLoaded', function() {
      startBlurUpdates();
    });
    
    // Carousel hover durumunda da Ã§alÄ±ÅŸsÄ±n
    const carousel = document.getElementById('featuredCarousel');
    if (carousel) {
      carousel.addEventListener('mouseenter', startBlurUpdates);
      carousel.addEventListener('mouseleave', startBlurUpdates);
    }
  </script>
{% endblock %}
